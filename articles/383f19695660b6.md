---
title: "ã€Dockerã€‘postgres image ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§å¯¾å¿œ"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Docker, Postgresql]
published: true
---

## ã¯ã˜ã‚ã«

Postgresql ã® Docker image ãŒç«‹ã¡ä¸ŠãŒã‚‰ãªã„äº‹è±¡ã®å¯¾å¿œã§ã™ã€‚

åŸå› ã¨ã—ã¦ã¯ã€`docker-compose.yml` ã«è¨˜è¼‰ã—ã¦ã„ã‚‹ `lastest` (æœ€æ–°æŒ‡å®š) ãŒåŸå› ã§èµ·ããŸäº‹è±¡ã§ã™ã€‚

```docker
image: postgres:latest
```

## å¯¾è±¡ Error

Error å†…å®¹ã‚’ç¢ºèªã™ã‚‹ç‚ºã«ã€`-d` ã¯ã¤ã‘ãšã«å®Ÿè¡Œã€‚

```bash
$ docker-compose up         
[+] Running 1/0
 â ¿ Container shift_schedule-db-1  Created                                                                                                              0.0s
Attaching to shift_schedule-db-1
shift_schedule-db-1  | 
shift_schedule-db-1  | PostgreSQL Database directory appears to contain a database; Skipping initialization
shift_schedule-db-1  | 
shift_schedule-db-1  | 2021-10-10 06:05:15.565 UTC [1] FATAL:  database files are incompatible with server
shift_schedule-db-1  | 2021-10-10 06:05:15.565 UTC [1] DETAIL:  The data directory was initialized by PostgreSQL version 13, which is not compatible with this version 14.0 (Debian 14.0-1.pgdg110+1).
shift_schedule-db-1 exited with code 1

```

ã©ã†ã‚„ã‚‰ã€æ—¢ã« postgresql ã‚’ version 13 ã§åˆæœŸåŒ–ã—ã¦ã„ã‚‹ã®ã«ã€`docker-compose.yml` ã§ã¯ `lastest` ã¨ã€æœ€æ–°æŒ‡å®šã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã„ã¦ã„ãŸã®ãŒ Error åŸå› ã®ã‚ˆã†ã§ã™ã€‚


## ä»Šå›ã®å¯¾å¿œ

### å¯¾è±¡ volume data ã‚’å‰Šé™¤

ä»Šå›ã¯ã€DBã®ä¸­èº«ã‚’ä¸€æƒã—ã¦ã‚‚å•é¡Œãªã‹ã£ãŸã®ã§ã€`volumes` å…ˆ ã® `data` ã‚’å‰Šé™¤ã—ã¦å¯¾å¿œã—ã¾ã—ãŸã€‚


1. Docker DashBoard ã§ å¯¾è±¡ã® volume data ã‚’ç¢ºèª
ã“ã“ã§ã€`IN USE` ã¨ãªã£ã¦ã„ã¦å‰Šé™¤ã§ããªã‹ã£ãŸã®ã§ã€ `docker-compose down`  ã§ä¸€æ—¦ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/07bb94725bce790aed0a4540.png)

2. 3ç‚¹ãƒªãƒ¼ãƒ€ ã‹ã‚‰ `Remove` ã‚’é¸æŠ
![](https://storage.googleapis.com/zenn-user-upload/7fe77a3ddc75aac5ebd8dc77.png)

3. Remove ã‚’é¸æŠ
![](https://storage.googleapis.com/zenn-user-upload/fabd052841b8d2a1d812bd11.png)

ä»¥ä¸Šã§ã€`volume data` ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã­ã€‚


## ä»–ã«è€ƒãˆã‚‰ã‚Œã‚‹å¯¾å¿œ

```docker
image: postgres:latest
```

`latest` ã§æœ€æ–°ã«ã›ãš `å¯¾å¿œãƒãƒ¼ã‚¸ãƒ§ãƒ³` ã§ image ã‚’æŒ‡å®šã™ã‚‹ã€‚

ä»Šå›ã® Error ã«åˆã‚ã™ãªã‚‰ã€`PostgreSQL version 13` ã«åˆã‚ã›ã‚‹ã¨ã‚ˆã•ãã†ã§ã™ã€‚

```docker
image: postgres:13.0
```

## ã¾ã¨ã‚

Error æ–‡ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€çµæ§‹ã™ã‚“ãªã‚Šå¯¾å¿œã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼
å¼•ãç¶šãã€æ¬¡ã®ä½œæ¥­ã«ã‹ã‹ã‚ŠãŸã„ã¨æ€ã„ã¾ã™!!

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ!
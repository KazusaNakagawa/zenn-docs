---
title: "ã€AWS S3ã€‘ AWS CLI ã§ S3 ã«æ ¼ç´ã—ã¦ã„ã‚‹ Bucket ã‚’æ¤œç´¢è¡¨ç¤ºã™ã‚‹"
emoji: "ğŸ”„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [aws, S3]
published: true
---

## ã¯ã˜ã‚ã«
S3 ã§ Bucket ä¸€è¦§ã‚’ã€æŒ‡å®šæ™‚é–“ã§è¡¨ç¤ºã•ã›ã‚‹ã€‚
## çµè«–
`system timestamp` ã‚’å–å¾—ã—ãŸã„æ™‚ã¯ã€`boto3`ã§ã¯å–å¾—ã§ããªã„ã®ã§ã€`AWS CLI`ã§å¯¾å¿œã™ã‚‹ã€‚

## ã‚„ã‚ŠãŸã„ã“ã¨
s3 ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ Bucketå ã‹ã‚‰ã€æŒ‡å®šã—ãŸæ™‚é–“ã§ Bucketåã‚’å–å¾—ã—ãŸã„ã€‚

- `grep` `-e` option ã§ç¹‹ã’ `or` æ¡ä»¶ã§ã€æŒ‡å®šã—ãŸæ—¥ä»˜ã‚’æ¤œç´¢è¡¨ç¤ºã§ãã‚‹

### è©¦ã—ã¦ã¿ã‚‹

```bash:AWS CLI
# syntax
$ aws s3 ls | grep -e [æŒ‡å®šæ—¥] -e [æŒ‡å®šæ—¥] ...
```

1. ç¾åœ¨ç™»éŒ²ã—ã¦ã„ã‚‹ Bucket ä¸€è¦§ã‚’è¡¨ç¤º
```bash:AWS CLI
$ aws s3 ls
2021-10-30 14:15:24 testbucket-2021-10-30-14h15m22s
2021-10-30 14:15:28 testbucket-2021-10-30-14h15m26s
2021-10-30 14:15:31 testbucket-2021-10-30-14h15m29s
2021-10-30 23:27:49 testbucket-2021-10-30-23h27m46s
2021-10-30 23:28:13 testbucket-2021-10-30-23h28m09s
2021-10-30 23:28:14 testbucket-2021-10-30-23h28m12s
2021-10-30 23:28:16 testbucket-2021-10-30-23h28m14s
2021-10-30 23:28:18 testbucket-2021-10-30-23h28m16s
2021-10-30 23:28:22 testbucket-2021-10-30-23h28m18s
2021-10-30 23:28:24 testbucket-2021-10-30-23h28m22s
2021-10-30 23:28:26 testbucket-2021-10-30-23h28m24s
2021-10-30 23:28:28 testbucket-2021-10-30-23h28m26s
2021-10-30 23:28:32 testbucket-2021-10-30-23h28m30s
2021-10-30 23:28:34 testbucket-2021-10-30-23h28m31s
```

2. `-e` option ã§ç¹‹ã’ã‚‹ã¨ `or` æ¡ä»¶ã§æ¤œç´¢ã§ãã‚‹

```bash:AWS CLI
$ aws s3 ls | grep -e 14:15:24 -e 14:15:28 -e 14:15:28 -e 14:15:31 -e 23:28:14
2021-10-30 14:15:24 testbucket-2021-10-30-14h15m22s
2021-10-30 14:15:28 testbucket-2021-10-30-14h15m26s
2021-10-30 14:15:31 testbucket-2021-10-30-14h15m29s
2021-10-30 23:28:14 testbucket-2021-10-30-23h28m12s
```

## âœï¸ã¾ã¨ã‚

- `grep -e` ã§è¡¨ç¤ºã—ãŸã„ Bucketåã¯å‡ºåŠ›ã§ããŸ
- å…¥åŠ›ã‚³ãƒãƒ³ãƒ‰ãŒã€å†—é•·ã«ãªã£ã¦ã„ã‚‹ã®ã§æ”¹å–„ã—ãŸã„ã¨ã“ã‚

## ğŸ“„ ãƒ¡ãƒ¢ AWS CLI ã‚³ãƒãƒ³ãƒ‰

### $ aws s3 ls

ä»Šå›ã€è©¦ã—ã§ä½¿ç”¨ã™ã‚‹ Bucketå: `testbucket-yyyymmdd`

**æ¤œç´¢ã§ãã‚‹**
```bash:AWS CLI

$ aws s3 ls | grep testb
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep d$
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep ^20
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep ^2021-10-28
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep 23:49
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep t-..y...dd
2021-10-28 23:49:00 testbucket-yyyymmdd
```

**æ¤œç´¢ã§ããªã„**
```bash:AWS CLI
$ aws s3 ls | grep test$

$ aws s3 ls | grep ^test$

$ aws s3 ls | grep ^test

$ aws s3 ls | grep ^2021-10-29
```

### $ aws s3 mv

- local file ã‚’æŒ‡å®šbucket ã«ç§»ã™
- ç§»ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€s3 ã«ç§»ã—ãŸã®å­˜åœ¨ã—ãªã„


```bash:AWS CLI
# syntax
$ aws s3 mv <local file path> <s3://<bucket name>>
```

```bash:AWS CLI
$ aws s3 mv models/storage.py s3://bucket1-name
# Output:
move: models/storage.py to s3://bucket1-name/storage.py
```

- s3 ã‹ã‚‰ local ã¸ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•

```bash:AWS CLI
# syntax
$ aws s3 mv <s3://<bucket name>> <local file path>
```

```bash:AWS CLI
$ aws s3 mv s3://bucket1-name/storage.py .
# Output:
move: s3://bucket1-name/storage.py to ./storage.py
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ã‚³ãƒãƒ³ãƒ‰ãŸã‚ã—ã¦ã¿ã‚‹

> - `--human-readable`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’Bytes/MiB/KiB/GiB/TiB/PiB/EiBã§è¡¨ç¤º
> - `--summarize`: çµæœãƒªã‚¹ãƒˆã®æœ€å¾Œã«ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç·æ•°ã¨ã‚µã‚¤ã‚ºã®åˆè¨ˆã‚’è¡¨ç¤º
> [å¼•ç”¨: AWS CLI Command Reference](https://docs.aws.amazon.com/cli/latest/reference/s3/ls.html#:~:text=Example%205%3A%20Summarizing%20all%20prefixes%20and%20objects%20in%20a%20bucket)


```bash:AWS CLI
$ aws s3 ls s3://bucket1-name --human-readable --summarize
2021-10-30 08:36:57    7.4 KiB storage.py

Total Objects: 1
   Total Size: 7.4 KiB
```

## ğŸ‘‰ å‚è€ƒ
- [AWS CLI ã§ã®é«˜ãƒ¬ãƒ™ãƒ« (S3) ã‚³ãƒãƒ³ãƒ‰ã®ä½¿ç”¨](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-services-s3-commands.html)
- [AWS CLI Example 4: Recursively listing all prefixes and objects in a bucket](https://docs.aws.amazon.com/cli/latest/reference/s3/ls.html#:~:text=Example%204%3A%20Recursively%20listing%20all%20prefixes%20and%20objects%20in%20a%20bucket)

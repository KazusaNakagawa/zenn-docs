---
title: "【AWS S3】 Python boto3 or AWS CLI"
emoji: "🔄"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [aws, S3, Python, boto3, Docker]
published: false
---

## はじめに
AWS S3 で ファイル一覧を、指定日以降で取り出すにはどうするか検討してみる

## 結論
`system timestamp` を取得したい時は、`boto3`では取得できないので、`AWS CLI`で対応する

## やりたいこと
s3 に格納されているファイルから、指定日付以降のファイル一覧を取得したい

## 処理フロー

1. `$ aws s3 ls` でIF連携ファイル一覧を取得
2. loop処理で、各フォルダ単位ごとに、`$ aws s3 ls`
3. [snowflake 連携ステータス管理TBL] から、過去1週間前の処理時間を取得する
4. 取得済みとしたファイルを、[snowflake 連携ステータス管理TBL] に取得済みとして保存する
5.

## できたこと

## できなかったこと

## まとめ

## AWS CLI コマンド

### aws s3 ls

- 格納bucket名: `testbucket-yyyymmdd`

**検索できる**
```bash:AWS CLI

$ aws s3 ls | grep testb
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep d$
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep ^20
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep ^2021-10-28
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep 23:49
2021-10-28 23:49:00 testbucket-yyyymmdd

$ aws s3 ls | grep t-..y...dd
2021-10-28 23:49:00 testbucket-yyyymmdd
```

**検索できない**
```bash:AWS CLI
$ aws s3 ls | grep test$

$ aws s3 ls | grep ^test$

$ aws s3 ls | grep ^test

$ aws s3 ls | grep ^2021-10-29

```

### aws s3 mv

- local file を指定bucket に移す
- 移したファイルは、s3 に移したの存在しない


```bash:AWS CLI
# syntax
$ aws s3 mv <local file path> <s3://<bucket name>>
```

```bash:AWS CLI
$ aws s3 mv models/storage.py s3://bucket1-name
# Output:
move: models/storage.py to s3://bucket1-name/storage.py
```

- s3 から local へファイル移動

```bash:AWS CLI
# syntax
$ aws s3 mv <s3://<bucket name>> <local file path>
```

```bash:AWS CLI
$ aws s3 mv s3://bucket1-name/storage.py .
# Output:
move: s3://bucket1-name/storage.py to ./storage.py

```

### オプション

- `--human-readable`: ファイルサイズをBytes/MiB/KiB/GiB/TiB/PiB/EiBで表示
- `--summarize`: 結果リストの最後に、オブジェクトの総数とサイズの合計を表示

```bash:AWS CLI
$ aws s3 ls s3://bucket1-name --human-readable --summarize
2021-10-30 08:36:57    7.4 KiB storage.py

Total Objects: 1
   Total Size: 7.4 KiB
```

## 参考
- [AWS CLI での高レベル (S3) コマンドの使用](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-services-s3-commands.html)

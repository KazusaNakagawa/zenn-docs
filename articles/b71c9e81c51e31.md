---
title: "ã€AWS S3ã€‘ Python boto3 ã‚’ä½¿ã„æ“ä½œã—ã¦ã¿ã‚‹"
emoji: "ğŸ”„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [aws, S3, Python, boto3]
published: true
---

## ã¯ã˜ã‚ã«
AWS S3 ã‚’ API `boto3` ã‚’ä½¿ã£ã¦ Bucket ä½œæˆã‹ã‚‰æ“ä½œã—ã¦ã¿ã¾ã—ãŸã€‚
ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ­ã‚°åãå‡ºã—ãªã©è’ã„ã®ã§ãƒ„ãƒƒã‚³ãƒŸã©ã“ã‚ã‚ã‚‹ã‹ã¨ã€‚
åŠ›ä¸è¶³ãªã®ã§ã€å¼•ãç¶šãå®Ÿè£…ã¯ç¶™ç¶šã—ã¦ç¶šã‘ã¦ã„ãã¾ã™!!

ã¨ã‚Šã‚ãˆãšã€æ„å›³ã—ãŸå‹•ä½œã¯å®Ÿè£…ã§ããŸã®ã§æµã‚Œã‚’æ®‹ã—ã¦ãŠã“ã†ã‹ã¨ã€‚


## ã§ããŸã“ã¨
- S3 ãƒãƒƒã‚±ãƒƒãƒˆ:ã€ç”Ÿæˆ / å‰Šé™¤ã€‘
- S3 ãƒ•ã‚¡ã‚¤ãƒ«:ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ / ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ /å‰Šé™¤ã€‘

## å¾Œã«è©¦ã—ãŸã„ã“ã¨

- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `response` ã®å€¤ã‚’ä½¿ã£ã¦å˜ä½“ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã‚‹
- `mock` ã‚‚ã‚„ã£ã¦ã¿ãŸã„



## å‹•ä½œç’°å¢ƒ

```python
- Mac M1
- Python: 3.9.1

# è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- boto3: 1.18.44
```

:::message
boto3 ã¯ã€[pypl â†—ï¸](https://pypi.org/project/boto3/) ã® Getting Startedã€€ã«å¾“ã„ å¯¾è±¡ã® repository ã‚’ cloneã™ã‚‹ã‚ˆã†ã§ã™ã€‚
ã§ãªã„ã¨ã€`$ python -m pip install boto3` ã§ install ã§ããš Error ã—ã¾ã—ãŸã€‚

> AttributeError: module 'pip._vendor_.six.moves.urllib.request' has no attribute 'addbase' 
:::

```bash:bash
# clone
$ git clone https://github.com/boto/boto3.git 
```


## ãƒªãƒã‚¸ãƒˆãƒª
è‰²ã€…è©¦ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã«ãªã‚‹ã®ã§ã€æœ¬è¨˜äº‹ã§æ›¸ã„ãŸå‹•ä½œä»¥å¤–ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ğŸ™

- [python_test_fixture](https://github.com/KazusaNakagawa/python_test_fixture)

## å‰ææ¡ä»¶

- AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚ã‚Š
- AWS IMAä½œæˆæ¸ˆ


## å‰å‡¦ç†
ãƒ­ãƒ¼ã‚«ãƒ«ã§ã€IMAãƒ¦ãƒ¼ã‚¶ã®è¨­å®šãŒå¿…è¦ã ã£ãŸã®ã§ã€`AWS CLI` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚
ä»–ã«ã‚‚ã€ç’°å¢ƒå¤‰æ•°ã«æŒãŸã›ã¦ IMAãƒ¦ãƒ¼ã‚¶ã‚’å‘¼ã³å‡ºã™æ–¹æ³•ãŒã‚ã‚Šãã†ã§ã—ãŸãŒã€è©¦ã—ã¦ã¾ã›ã‚“ãƒ¼


### AWS CLI ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ [#1](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-mac.html)

* macOS pkg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

  æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® **AWS CLI** ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«


* ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’æ‰‹å‹•ã§ä½œæˆ `PATH` ã‚’é€šã™

```bash:bash
$ sudo ln -s /folder/installed/aws-cli/aws /usr/local/bin/aws
$ sudo ln -s /folder/installed/aws-cli/aws_completer /usr/local/bin/aws_completer
```


* ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æ¤œè¨¼

```bash:bash
$ which aws
/usr/local/bin/aws

$ aws --version
aws-cli/2.2.36 Python/3.8.8 Darwin/20.6.0 exe/x86_64 prompt/off
```


### [Configuration](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html#configuration) ã®è¨­å®š

AWS CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã§ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§ä»¥å‰ä½œæˆã—ã¦ã„ãŸ**IAMãƒ¦ãƒ¼ã‚¶**(ä½œæˆæ–¹æ³•ã¯å‰²æ„›)ã§aws ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚


```bash:bash
# å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
$ aws configure

# èã‹ã‚Œã‚‹é …ç›®ã‚’å…¥åŠ›
AWS Access Key ID [None]: <Access Key ID> # IAM ã®ã€€key
AWS Secret Access Key [None]: <Secret Access Key> # IAM ã®ã€€key
Default region name [None]: ap-northeast-1 # #2ã‚’å‚è€ƒã«tokyoã‚’é¸æŠ
Default output format [None]: json # ã¨ã‚Šã‚ãˆãš json
```


## ãƒ„ãƒªãƒ¼æ§‹æˆ

- ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Ÿè£…ã—ã¾ã—ãŸ!
```bash:tree
â”œâ”€â”€ api
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ controllers
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ bucket_controller.py # S3æ“ä½œ
â”‚Â Â  â”œâ”€â”€ models
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ bucket.py # æ©Ÿèƒ½å®Ÿè£…
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logger_tool.py
â”‚Â Â  â”‚Â Â  â””â”€â”€ time.py
â”œâ”€â”€ config
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â””â”€â”€ const.py # å®šæ•°ã¾ã¨ã‚ã¦ã‚‹
â”œâ”€â”€ data # s3 uploadç”¨
â”‚Â Â  â”œâ”€â”€ response.json
â”‚Â Â  â”œâ”€â”€ test.sql
â”‚Â Â  â”œâ”€â”€ user.json
â”‚Â Â  â””â”€â”€ user.sql
â”œâ”€â”€ log
â”‚Â Â  â””â”€â”€ bucket.log # S3æ“ä½œå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ main.py # å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ tmp # S3 dwonload ç”¨
â”‚Â Â  â”œâ”€â”€ user.json
â”‚Â Â  â””â”€â”€ user.sql
```

## ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

### model

S3 Bucket ã‚’æ“ä½œã™ã‚‹ model ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
åŸºæœ¬ `Bucket model` ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãäºˆå®šã§ã™!!

ä»Šã®ã¨ã“ã‚ã€ä¸‹è¨˜ã‚’å®Ÿè£…ã—ã¾ã—ãŸ!

- S3 ãƒãƒƒã‚±ãƒƒãƒˆ:ã€ ç”Ÿæˆ / å‰Šé™¤ ã€‘
- S3 ãƒ•ã‚¡ã‚¤ãƒ«:ã€ å˜ä½“: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ / ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ / å‰Šé™¤ ã€‘

ãƒ­ã‚°å–å¾—ã€ä¾‹å¤–å‡¦ç†ãŒç”˜ã„ã¨æ„Ÿã˜ã¦ãŠã‚Šã¾ã™ãŒã€ã¨ã‚Šã‚ãˆãšé€²ã‚ã¾ã™ã€‚

`logger` ãŒå¤šãã¦ã¿ã«ãã„...ã€‚

bucket å‰Šé™¤ã‚‚ä¸€æ‹¬ã˜ã‚ƒãªãã¦ã€æŒ‡å®š bucket ã®ã¿å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ããŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚


```python:api/models/bucket.py
import boto3

from botocore.exceptions import ClientError
from pathlib import Path

from api.models import logger_tool
from config import const


class Bucket(object):

    def __init__(self, client: str, bucket_name: str, region: str):
        """

        params
        ------
        client(str): s3
        bucket_name(str): choice bucket name
        region(str): Region code
        """
        self.client = boto3.client(client)
        self.resource_bucket = boto3.resource(client)
        self.bucket_name = bucket_name
        self.region = region

   def create_bucket(self):
        """ Bucket ã‚’ä½œæˆã™ã‚‹å‡¦ç†
        ref
        -------
        https://github.com/aws/aws-cli/issues/2603#issuecomment-349191935

        params
        -------
        max_key(int): default: 2
            is_bucket_check fuc args

        """

        logger_tool.info(
            action='create',
            status='run',
            bucket_name=self.bucket_name
        )

        try:
            self.client.create_bucket(
                Bucket=self.bucket_name,
                CreateBucketConfiguration={'LocationConstraint': self.region}
            )

        except self.client.exceptions.BucketAlreadyExists as err:
            logger_tool.error(
                action='create',
                status=409,
                bucket_name=self.bucket_name,
                ex=err,
                msg="Bucket {} already exists!".format(err.response['Error']['BucketName']),
            )
            raise err

        logger_tool.info(
            action='create',
            status=200,
            bucket_name=self.bucket_name
        )


    def upload_data(self, bucket_name: str, upload_data: str):
        """
        params
        ------
        upload_data: ex) sample.png
        """
        key = upload_data.split('/')[-1]

        logger_tool.info(
            action='upload',
            status='run',
            bucket_name=bucket_name,
            data=key,
        )

        with open(upload_data, 'rb') as upload_data_file:
            self.resource_bucket.Bucket(bucket_name).put_object(Key=key, Body=upload_data_file)

        logger_tool.info(
            action='upload',
            status=200,
            bucket_name=bucket_name,
            data=key,
        )

    def download_data(self, download_data: str) -> None:
        """
        Bucket ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

        params
        ------
        download_data(str): S3ã«ã‚ã‚‹æŒ‡å®šãƒ‡ãƒ¼ã‚¿ã‚’ download ã™ã‚‹
        """
        # download ç”¨ã«ä½œæˆ
        Path(const.TMP_PATH).mkdir(exist_ok=True)

        logger_tool.info(
            action='download',
            status='run',
            bucket_name=self.bucket_name,
            data=download_data,
        )
        try:
            self.resource_bucket.meta.client.download_file(
                self.bucket_name, download_data, f"tmp/{download_data}"
            )
            logger_tool.info(
                action='download',
                status=204,
                bucket_name=self.bucket_name,
                data=download_data,
            )

        except ClientError as ex:
            logger_tool.error(
                action='download',
                status=404,
                bucket_name=self.bucket_name,
                ex=ex
            )

    def delete_data(self, bucket_name: str, delete_data: str):
        """
        bucketã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤

        params
        ------
        bucket_name(str):  Bucket name
        delete_data(data): å‰Šé™¤ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å

        return
        ------
        response: å‰Šé™¤ãŒæˆåŠŸã—ãŸçµæœã‚’è¿”ã™ãƒ¬ã‚¹ãƒãƒ³ã‚¹ parameter
        """

        key = delete_data.split('/')[-1]

        logger_tool.info(
            action='delete',
            status='run',
            bucket_name=bucket_name,
            data=key,
        )
        try:
            response = self.client.delete_object(
                Bucket=bucket_name,
                Key=key,
            )
            return response

        except ClientError as ex:
            logger_tool.error(
                action='delete data',
                status=404,
                bucket_name=bucket_name,
                ex=ex
            )

        logger_tool.info(
            action='delete',
            status=204,
            bucket_name=bucket_name,
            data=key,
        )

        ...

    def delete_all_buckets(self):
        """
        å…¨ã¦ã® bucketã‚’å‰Šé™¤ã™ã‚‹

        return
        ------
        response: bucket ã‚’å‰Šé™¤ã—ãŸçµæœã‚’è¿”ã™ response parameter
        """

        buckets = list(self.resource_bucket.buckets.all())

        if buckets:
            logger_tool.info(
                action='delete',
                status='run',
                bucket_name=self.bucket_name
            )

            response = [key.delete() for key in self.resource_bucket.buckets.all()]

            logger_tool.info(
                action='delete',
                status=204,
                bucket_name=self.bucket_name
            )
            return response

```

### ãƒ­ã‚°åãå‡ºã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š

`{ key: value }` ã§å‡ºåŠ›ã—ãŸã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š

ãƒ­ã‚°åãå‡ºã—ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¿æ•´ãƒ»è¡Œæ•°ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å…¥ã‚Œã¦ã¿ãŸã‹ã£ãŸã‚“ã§ã™ãŒå‰²æ„›ã€‚
è¿½ã€…ã§ãã‚Œã°ã„ã„ãªã£ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚


```python:api/models/logger_tool.py
import logging

from api.models import time
from config import const

from pathlib import Path

# CREATE DIR
Path(const.LOGFILE_PATH).mkdir(exist_ok=True)

logging.basicConfig(filename=Path(f"{const.LOGFILE_PATH}{const.LOG_FILE}"), level=logging.INFO)
logger = logging.getLogger(__name__)


def error(action, status, bucket_name: str, ex, msg=None):
    logger.error({
        'time': time.datetime_now(),
        'action': action,
        'status': status,
        'bucket name': bucket_name,
        'except': ex,
        'msg': msg,
    })


def info(action, status, bucket_name: str, data=None):
    logger.info({
        'time': time.datetime_now(),
        'action': action,
        'status': status,
        'bucket name': bucket_name,
        'data': data,
    })

```

### ãƒ­ã‚°åãå‡ºã—æ™‚é–“ã‚’å–ã‚Šå‡ºã™ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«

ãƒ­ã‚°åãå‡ºã—æ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’èª¿æ•´ã€‚

```python:api/models/time.py
import datetime


def datetime_now():
    return datetime.datetime.now().isoformat()[:19]

```

```python:result
# ç§’ã¾ã§å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´
>>> '2021-09-12T23:42:32'
```

### const

å®šæ•°ã¨ã—ã¦ã¾ã¨ã‚ãŸã‹ã£ãŸã®ã§ã€ä¸€æ‹¬ã«ã¾ã¨ã‚ãŸå½¢ã§ã™ã€‚
å³å¯†ã«ã¯ã€å‘¼ã³å‡ºã—ãŸæ™‚ã«ã€æ›¸ãæ›ãˆã§ãã¡ã‚ƒã†ã®ã§ã‚ã—ã‹ã‚‰ãšã€‚


```python:config/const.py
# å®Ÿè¡Œã¯ 0: False, 1: True ã§åˆ‡ã‚Šåˆ†ã‘

CLIENT = 's3'
BUCKET_NAME = 'testbucket-yyyymmdd'
TOKYO_REGION = 'ap-northeast-1'

LOGFILE_PATH = 'log/'
LOG_FILE = 'bucket.log'
TMP_PATH = 'tmp/'

BUCKET_CREATE = 1
BUCKET_DELETE = 1

UPLOAD = 1
DOWNLOAD = 0
DELETE = 1

```

å› ã¿ã«ã€ä¸Šã®è¨­å®šã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã—ã¾ã™ã¨ã€

1. S3 ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
3. data/ é…ä¸‹ ã®ãƒ‡ãƒ¼ã‚¿ã‚’ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
4. ã™ãã«ã€S3 ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸ ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
5. ãƒã‚±ãƒƒãƒˆã‚’å‰Šé™¤


ã¨ãªã‚Šã¾ã™ã€‚

å‹•ãã¨ã—ã¦ã¯ã€ãƒã‚±ãƒƒãƒˆä½œæˆã—ã¦æœ€å¾Œã«ã™ãæ¶ˆã—ã¦ã„ã¾ã™ã€‚
ä½•ã‚„ã£ã¦ã‚“ã® ... ã£ã¨ãªã‚Šã¾ã™ãŒã€ã¾ã‚å‹•ä½œç¢ºèªã¨ã—ã¦ã¯è‰¯ã•ãã†ã§ã™ã€‚


### controller

`bucket_controller.py` ã§S3æ“ä½œã‚’ã§ãã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã—ãŸã€‚
ã»ã‚“ã¾ã§ã™ã¨ã€**ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ä½œæˆã—ã¦å®šæœŸå®Ÿè¡Œã®ã‚¸ãƒ§ãƒ–ã‚’çµ„ã‚€ã‚“ã§ã—ã‚‡ã†ãŒã‚„ã£ãŸäº‹ãªã„ã®ã§ä¿ç•™ã€‚ãã‚Œã‹ã€**Lambad** ã§å®Ÿè¡Œã™ã‚‹ã‚“ã§ã™ã‹ã­ğŸ¤”

ã¾ãŸã€æ¬¡å›ä»¥é™è©¦ã—ã¦ã¿ã‚‹ã®ã‚‚é¢ç™½ãã†ã§ã™www

```python:api/controllers/bucket_controller.py
from config import const
from api.models import bucket


def s3_bucket_management():
    """ aws s3 management """
    management_bucket = bucket.Bucket(client=const.CLIENT, bucket_name=const.BUCKET_NAME, region=const.TOKYO_REGION)

    # TODO: æŒ‡å®š Directory ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹
    data_list = ['user.sql', 'user.json']

    if const.BUCKET_CREATE:
        management_bucket.create_bucket()

    if const.UPLOAD:
        for data in data_list:
            management_bucket.upload_data(bucket_name=const.BUCKET_NAME, upload_data=f"data/{data}")

    if const.DOWNLOAD:
        for data in data_list:
            management_bucket.download_data(download_data=data)

    if const.DELETE:
        for data in data_list:
            management_bucket.delete_data(bucket_name=const.BUCKET_NAME, delete_data=f"data/{data}")

    if const.BUCKET_DELETE:
        management_bucket.delete_all_buckets()

    # æœ€çµ‚çš„ã«å­˜åœ¨ã—ã¦ã„ã‚‹ Bucketã‚’ç¢ºèªã™ã‚‹
    management_bucket.print_bucket_name()


```

### main ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
æœ€å¾Œã«ã€å®Ÿè¡Œå‡¦ç†ã‚’ã€`main.py` ã«æ›¸ã„ã¦ãŠã‘ã°è‰¯ã•ãã†ã§ã™ã€‚

```python:main.py
import api.controllers.bucket_controller

if __name__ == '__main__':
    api.controllers.bucket_controller.s3_bucket_management()
```



## å®Ÿè¡Œçµæœ

`main.py` ã‚’å®Ÿè¡Œã—çµæœã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™!

```log:bucket.log
# IMA ãƒ¦ãƒ¼ã‚¶ ã§è¨­å®šã—ãŸèªè¨¼æƒ…å ±ã‚’ç¢ºèª
INFO:botocore.credentials:Found credentials in shared credentials file: ~/.aws/credentials

# Bucketã‚’ç”Ÿæˆ
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:06', 'action': 'create', 'status': 'run', 'bucket name': 'testbucket-yyyymmdd', 'data': None}
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:08', 'action': 'create', 'status': 200, 'bucket name': 'testbucket-yyyymmdd', 'data': None}

# data/ é…ä¸‹ã«æ ¼ç´ã—ã¦ã„ãŸæŒ‡å®šãƒ‡ãƒ¼ã‚¿ã‚’ S3 ã« upload
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:08', 'action': 'upload', 'status': 'run', 'bucket name': 'testbucket-yyyymmdd', 'data': 'user.sql'}
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:09', 'action': 'upload', 'status': 200, 'bucket name': 'testbucket-yyyymmdd', 'data': 'user.sql'}
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:09', 'action': 'upload', 'status': 'run', 'bucket name': 'testbucket-yyyymmdd', 'data': 'user.json'}
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:09', 'action': 'upload', 'status': 200, 'bucket name': 'testbucket-yyyymmdd', 'data': 'user.json'}

# ãã—ã¦ã™ãã•ã¾ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:09', 'action': 'delete', 'status': 'run', 'bucket name': 'testbucket-yyyymmdd', 'data': 'user.sql'}
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:09', 'action': 'delete', 'status': 'run', 'bucket name': 'testbucket-yyyymmdd', 'data': 'user.json'}

# ã‚“ã§ã€Bucket ã‚’å‰Šé™¤
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:09', 'action': 'delete', 'status': 'run', 'bucket name': 'testbucket-yyyymmdd', 'data': None}
INFO:api.models.logger_tool:{'time': '2021-09-18T14:20:10', 'action': 'delete', 'status': 204, 'bucket name': 'testbucket-yyyymmdd', 'data': None}

```

ä¸­èº«ã‚’ã¿ã¦ã„ãã¾ã™ã€‚

æ„å›³ã—ãŸæµã‚Œã§å‡¦ç†å®Ÿè¡Œã§ãã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

æ°—ã«ãªã‚‹ç‚¹ã¯ã€INFO:`api.models.logger_tool` ã¨logger_tool ã®ãƒ•ã‚¡ã‚¤ãƒ«åã§ãƒ­ã‚°ãŒåã‹ã‚Œã¦ã„ã‚‹ã¨ã“ã‚!

ã“ã“ã¯æ›¸ãå‡ºã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã§ãƒ­ã‚°åãå‡ºã—ã§ãã‚‹ã‚ˆã†ã«èª¿æ•´ã—ãŸã„ã§ã™ã€‚

æ”¹å–„å¿…é ˆã§ã™ã€‚




## ã¾ã¨ã‚
ã¾ã ã¾ã ã€å®Ÿç”¨ã§ã¯ä½¿ãˆãªã„ãƒ¬ãƒ™ãƒ«ã§ã™ãŒã€S3 ã®æ“ä½œãŒè»½ãç†è§£ã§ããŸã®ã§è‰¯ã‹ã£ãŸã§ã™ã€‚

æ¬¡ã¯ã€**å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** ãªã©è©¦ã—ã¦ã¿ãŸã„ã§ã™ã­ã€‚

ç§ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’è¾¼ã‚ãŸå†…å®¹ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ã‚‚ã£ã¨ã“ã†æ›¸ã„ãŸæ–¹ãŒè‰¯ã„ãªã©ã€æ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆé ‚ã‘ã‚‹ã¨å¹¸ã„ã§ã™ğŸ™

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ!!


## å‚è€ƒ

- [Boto3 Docs Quickstart](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html)
- [Catching exceptions when using a resource client](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/error-handling.html#catching-exceptions-when-using-a-resource-client)
- https://pypi.org/project/boto3/
- [macOS ã§ã® AWS CLI ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 2 ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€æ›´æ–°ã€ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-mac.html) #1
- [èªè¨¼æƒ…å ±ã®å…±æœ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ](https://docs.aws.amazon.com/ja_jp/ses/latest/DeveloperGuide/create-shared-credentials-file.html)
- [AWS SDK for Python (Boto3)](https://aws.amazon.com/sdk-for-python/)
- [AWS åˆ©ç”¨ã§ãã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#:\~:text=%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E6%8C%87%E5%AE%9A-,%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3,-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8A%E3%80%81%E5%88%A9%E7%94%A8) #2
- [Create an Amazon S3 bucket](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-example-creating-buckets.html#create-an-amazon-s3-bucket)
- [https://github.com/aws/aws-cli/issues/2603#issuecomment-349191935](https://github.com/aws/aws-cli/issues/2603#issuecomment-349191935)
- [HTTP response code for POST when resource already exists](https://stackoverflow.com/questions/3825990/http-response-code-for-post-when-resource-already-exists)
